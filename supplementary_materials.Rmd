---
title: "Opinions on Hard-to-Discuss Topics Change More via Cohort Replacement"
author: 
  - Nicolas Restrepo Ochoa, Anthropology Department, Univerity of California at Davis.
  - Stephen Vaisey, Sociology Department, Duke University.
output:
  pdf_document:
  html_document:
    toc: yes
    theme: united
header-includes:
- \usepackage{setspace}
- \doublespacing
- \usepackage{lineno}
- \linenumbers
- \def\linenumberfont{\normalfont\tiny\sffamily}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)

library(tidyverse)
library(countrycode)
library(janitor)
library(splines)
library(performance)
library(ggrepel)
library(hrbrthemes)
library(patchwork)
library(broom)
library(broom.mixed)
library(gtsummary)
library(labelled)
library(brms)
theme_set(theme_bw())


```

## Questions & Abbreviations 

1. Please tell me whether family is very important in your life, not important at all in your life, or something in between. (important_family)
2. Please tell me whether friends are very important in your life, not important at all in your life, or something in between. (important_friends)
3. Please tell me whether leisure is very important in your life, not important at all in your life, or something in between. (important_leisure)
4. Please tell me whether politics are very important in your life, not important at all in your life, or something in between. (important_politics)
5. Please tell me whether work is very important in your life, not important at all in your life, or something in between. (important_work)
6. Please tell me whether religion is very important in your life, not important at all in your life, or something in between. (important_religion)
7. There are many qualities that children can be encouraged to learn at home. Which, if any, do you consider to be especially important? (child_<quality>)
8. Would you rather not have people of a different race as neighbors? (neigh_diff_race)
9. Would you rather not have heavy drinkers as neighbors? (neig_drink)
10. Would you rather not have immigrants or foreign workers as neighbors? (neigh_imm)
11. Would you rather not have people with AIDS as neighbors? (neigh_aids)
12. Would you rather not have drug addicts as neighbors? (neigh_drugs)
13. Would you rather not have gay people as neighbors? (neigh_gay)
14. Would you say most people can be trusted or that you can never be too careful? (trust_people)
15. All things considered, how satisfied are you with your life as a whole these days? (life_satisf)
16. Some people feel they have completely free choice and control over their lives, while other people feel that what they do has no real effect on what happens to them. Please tell me whether you feel you have no choice and control at all over your life, a great deal of choice and control, or something in between. (choice_control)
17. Do you agree or disagree with the idea that when jobs are scarce, men should have more right to a job than women? (jobs_men_over_women)
18. Do you agree or disagree with the idea that when jobs are scarce, employers should give priority to people of this country over immigrants? (jobs_national_over_foreign)
19. Do you agree or disagree with the idea that being a housewife is just as fulfilling as working for pay? (housewife_fulfilling)
20. In political matters, people talk of “the left” and “the right.” How would you place your views on this scale, generally speaking? (politics_scale)
21. Would you say that incomes should be made more equal, that there should be greater incentives for individual effort, or something in between? (income_eq)
22. Would you say that businesses should be privately owned, publicly owned, or something in between? (pvt_state_owned)
23. Would you that the government should take more responsibility to ensure that everyone is provided for, that people should take more responsibility to provide for themselves, or something in between? (gvt_responsibility)
24. Would you say that competition is good, it is harmful, or something in between? (competition_good_evil)
25. How much confidence do you have in churches? (confidence_churches)
26. How much confidence do you have in the armed forces? (confidence_armed_forces)
27. How much confidence do you have in the press? (confidence_press)
28. How much confidence do you have in unions? (confidence_unions)
29. How much confidence do you have in the police? (confidence_police)
30. How much confidence do you have in parliament? (confidence_parliament)
31. How much confidence do you have in civil services? (confidence_civil)
32. How much confidence do you have in television? (confidence_television)
33. How much confidence do you have in the government? (confidence_government)
34. How much confidence do you have in political parties? (confidence_political_party)
35. How much confidence do you have in major companies? (confidence_major_companies)
36. How much confidence do you have in justice courts? (confidence_justice_courts)
37. How often do you attend religious services? (attend_relig)
38. Would you say you are religious, not religious, or an atheist? (religious_person)
39. Do you believe in God? (believe_god)
40. Do you believe in Hell? (believe_hell)
41. Please tell me whether God is very important in your life, not important at all in your life, or something in between. (important_god)
42. Please tell me whether you think claiming government benefits that you are not entitled to can always be justified, never be justified, or something in between. (just_gvt_benefits)
43. Please tell me whether you think avoiding a fare in public transportation can always be justified, never be justified, or something in between. (just_fare_public_trans)
44. Please tell me whether you think cheating on your taxes if you have a chance can always be justified, never be justified, or something in between. (just_cheat_taxes)
45. Please tell me whether you think accepting a bribe on the course of your duties can always be justified, never be justified, or something in between. (just_bribe)
46. Please tell me whether you think homosexuality can always be justified, never be justified, or something in between. (just_homosexuality)
47. Please tell me whether you think prostitution can always be justified, never be justified, or something in between. (just_prostitution)
48. Please tell me whether you think abortion can always be justified, never be justified, or something in between. (just_abortion)
49. Please tell me whether you think divorce can always be justified, never be justified, or something in between. (just_divorce)
50. Please tell me whether you think euthanasia always be justified, never be justified, or something in between. (just_euthanasia)
51. Please tell me whether you think suicide always be justified, never be justified, or something in between. (just_suicide)
52. How proud are you to be of the nationality of this country? (proud_nationality)

## Descriptive Summaries - Survey Data 

The following plots present the distributions for the sensitivity scores in our data.

We will begin with the USA: 

```{r, warning=F, message=F}
usa_d <- read_csv("Data/usa_data_full.csv") %>% mutate(country = "USA")
# Keep only the real answers (no headers, pretests or rejections)
usa_d <- usa_d[-c(1:5, 16:17, 19) ,]

swe_d <- read_csv("Data/swe_data_full.csv") %>% mutate(country = "SWE")
swe_d <- swe_d[-c(1:2),]

zaf_d <- read_csv("Data/zaf_data_full.csv") %>% mutate(country = "ZAF")
zaf_d <- zaf_d[-c(1:2),]

mex_d <- read_csv("Data/mex_data_full.csv") %>% mutate(country = "MEX")
mex_d <- mex_d[-c(1:2),]

jpn_d <- read_csv("Data/jpn_data_full.csv") %>% mutate(country = "JPN")
jpn_d <- jpn_d[-c(1:2),]

can_d <- read_csv("Data/can_data_full.csv") %>% mutate(country = "CAN")
can_d <- can_d[-c(1:2),]

aus_d <- read_csv("Data/aus_data_full.csv") %>% mutate(country = "AUS")
aus_d <- aus_d[-c(1:2),]

arg_d <- read_csv("Data/arg_data_full.csv") %>% mutate(country = "ARG")
arg_d <- arg_d[-c(1:8,60),]


usa_ds <- usa_d %>% 
  select(23:77,81)

swe_ds <- swe_d %>% 
  select(23:77,81)

zaf_ds <- zaf_d %>% 
  select(23:77,81)

mex_ds <- mex_d %>% 
  select(23:77,81)

jpn_ds <- jpn_d %>% 
  select(23:77,81)

can_ds <- can_d %>% 
  select(23:77,81)

aus_ds <- aus_d %>% 
  select(23:77,81)

arg_ds <- arg_d %>% 
  select(22:76,81)

d_sens_complete <- rbind(usa_ds,
                         swe_ds,
                         zaf_ds,
                         mex_ds,
                         jpn_ds,
                         can_ds,
                         aus_ds, 
                         arg_ds)

d_sens_complete <- d_sens_complete %>% 
  mutate(
    across( 
      .cols =1:55, 
      as.numeric
    )
  )

# If attention check succesful then 1, else 0
# Count attention checks
d_sens_complete <- d_sens_complete %>% 
  mutate(ac1 = if_else(att1_1 == 2, 1, 0), 
         ac2 = if_else(att2_1 == 5, 1, 0), 
         ac3 = if_else(att3_1 == 1, 1, 0), 
         ac = ac1+ac2+ac3)
rm(usa_d,
   swe_d,
   zaf_d,
   mex_d,
   jpn_d,
   can_d,
   aus_d)

rm(usa_ds,
   swe_ds,
   zaf_ds,
   mex_ds,
   jpn_ds,
   can_ds,
   aus_ds)

# Keep only respondents with 2 or more attention checks
d_sens_complete <- d_sens_complete %>% 
  filter(ac >=2)

d_sens_long <- d_sens_complete %>% 
  select(country, everything()) %>% 
  mutate(
    across( 
      .cols = 2:56, 
      as.numeric
    )
  ) %>% 
  pivot_longer(
    2:56, 
    names_to = "question", 
    values_to = "difficulty"
  ) %>% 
  mutate(
    question = str_remove(question, "_1$"), 
    variable = case_when( 
      question == "imp_family" ~ "important_family", 
      question == "imp_friends" ~ "important_friends", 
      question == "imp_leisure" ~ "important_leisure", 
      question == "imp_pol" ~ "important_politics", 
      question == "imp_wrk" ~ "important_work", 
      question == "imp_rel" ~ "important_religion", 
      question == "child_qualities" ~ "child_independence", 
      question == "neigh_race" ~ "neigh_diff_race", 
      question == "neigh_drink" ~ "neigh_drink", 
      question == "neigh_imm" ~ "neigh_imm", 
      question == "neigh_aids" ~ "neigh_aids", 
      question == "neigh_drug" ~ "neigh_drugs", 
      question == "neigh_gay" ~ "neigh_gay", 
      question == "trust" ~ "trust_people", 
      question == "life_satisf" ~ "life_satisf", 
      question == "choice_control" ~ "choice_control", 
      question == "scarce_jobs_women" ~ "jobs_men_over_women", 
      question == "scarce_jobs_imm" ~ "jobs_national_over_foreign", 
      question == "housewife_fulfill" ~ "housewife_fulfilling", 
      question == "left_right" ~ "politics_scale", 
      question == "equal_incomes" ~  "income_eq", 
      question == "private_public_busi" ~ "pvt_state_owned", 
      question == "gvt_responsibility" ~ "gvt_responsibility", 
      question == "comp_good_bad" ~ "competition_good_evil", 
      question == "conf_church" ~ "confidence_churches", 
      question == "conf_armed" ~ "confidence_armed_forces", 
      question == "conf_press" ~ "confidence_press", 
      question == "conf_unions" ~ "confidence_unions", 
      question == "conf_police" ~ "confidence_police", 
      question == "conf_parliament" ~ "confidence_parliament", 
      question == "conf_civil" ~ "confidence_civil", 
      question == "conf_tv" ~ "confidence_tv", 
      question == "conf_gvt" ~ "confidence_government", 
      question == "conf_pol_prt" ~ "confidence_political_parties", 
      question == "conf_companies" ~ "confidence_major_companies", 
      question == "conf_courts" ~ "confidence_justice_courts", 
      question == "rel_services" ~ "attend_relig", 
      question == "religiosity" ~ "religious_person", 
      question == "belief_god" ~ "believe_god", 
      question == "belief_hell" ~ "believe_hell", 
      question == "imp_god" ~ "important_god", 
      question == "just_gvt_benefits" ~  "just_gvt_benefits", 
      question == "just_public_trans" ~ "just_fare_public_trans", 
      question == "just_cheat_tax" ~ "just_cheat_taxes", 
      question == "just_bribe" ~ "just_bribe", 
      question == "just_homo" ~ "just_homosexuality", 
      question == "just_prst" ~ "just_prostitution", 
      question == "just_abort" ~ "just_abortion", 
      question == "just_divorce" ~ "just_divorce", 
      question == "just_euth" ~ "just_euthanasia", 
      question == "just_suicide" ~ "just_suicide", 
      question == "proud" ~ "proud_nationality", 
      TRUE ~ question),
  )

d_sens_long %>% 
  filter(country == "USA") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "USA",
    y = "Difficulty", 
    x = ""
  )
```

Let's now look at Sweden: 

```{r}
d_sens_long %>% 
  filter(country == "SWE") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty, na.rm = T)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "SWE",
    y = "Difficulty", 
    x = ""
  )
```

Let's examine South Africa: 

```{r}
d_sens_long %>% 
  filter(country == "ZAF") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "ZAF",
    y = "Difficulty", 
    x = ""
  )
```

Let's examine the responses for Mexico: 

```{r}
d_sens_long %>% 
  filter(country == "MEX") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "MEX",
    y = "Difficulty", 
    x = ""
  )
```

Let's examine the responses for Japan:

```{r}
d_sens_long %>% 
  filter(country == "JPN") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "JPN",
    y = "Difficulty", 
    x = ""
  )
```


Now, let's see the results from Canada: 

```{r}
d_sens_long %>% 
  filter(country == "CAN") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty, na.rm = T)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "CAN",
    y = "Difficulty", 
    x = ""
  )
```

Let's now look at Australia: 

```{r, message=F, warning=FALSE}
d_sens_long %>% 
  filter(country == "AUS") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty, na.rm = T)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "AUS",
    y = "Difficulty", 
    x = ""
  )
```

We finish by looking at the data from Argentina: 

```{r, message = F, warning=F}

d_sens_long %>% 
  filter(country == "ARG") %>% 
  group_by(
    variable
  ) %>% 
  mutate(
    avg = mean(difficulty, na.rm = T)
  ) %>% 
  ungroup() %>% 
  ggplot( 
    aes( x = fct_reorder(variable, avg), 
         y = difficulty)
    ) +
  geom_boxplot() + 
  coord_flip() +
  theme(text = element_text(size = 8)) +
  labs(
    title = "ARG",
    y = "Difficulty", 
    x = ""
  )
```

## Models

### Absolute Change and Sensitivity

We use this space to outline the specifications of the models we fit, as well as present the results in a more detailed manner. The first model we fit regresses the absolute change displayed by a variable on its sensitivity score. Given that the outcome variable has strictly positive values, we use the lognormal link. The model could be expressed as follows: 

$$ \text{Change}_i \sim \text{log-normal}(\mu_i, \sigma) $$
$$ \mu_i \sim \alpha_{\text{country}[i]} + \beta_{\text{country}[i]}S_i$$
$$ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}} \end{pmatrix} \; \sim \text{MVN} \bigg[ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}}   \end{pmatrix} \;, S \bigg]$$
$$ S = \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; R \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; $$

Table 1 displays the posterior estimates for the model:

```{r}
mod_change <- read_rds("model_abschange.rds")

tidy(mod_change) %>% 
  mutate(across(
    .cols = 5:8, 
    round, 
    2), 
    term = str_replace(term, "med", "sensitivity")) %>% 
  kableExtra::kable(format = "latex",
    align = "c",
    booktabs = TRUE,
    longtable = TRUE,
    linesep = "",
    ) %>%
  kableExtra::kable_styling(
      position = "left",
      latex_options = c("striped", "repeat_header"),
      stripe_color = "gray!15"
    )
```

The posterior predictions for the model look reasonable: 

```{r}
pp_check(mod_change) +
  labs(title = "Posterior Predictions", 
       subtitle = "Model for Absolute Change")
```

### Tau and Sensitivity 

Before we explore the model that features on the main text, we will present the results for a model that uses gaussian linear regression to examine the relationship between $\tau$ and an issue's sensitivity. Even though the conclusions are similar, the gaussian model exhibits poor ability to retrodict the data. Once we have established this shortcoming, the rationale behind the mixed model becomes clearer. 

The gaussian linear model can be expressed as follows: 

$$ \tau_i \sim \text{Normal}(\mu_i, \sigma) $$
$$ \mu_i \sim \alpha_{\text{country}[i]} + \beta_{\text{country}[i]}S_i$$
$$ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}} \end{pmatrix} \; \sim \text{MVN} \bigg[ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}}   \end{pmatrix} \;, S \bigg]$$
$$ S = \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; R \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; $$

Table 2 displays the posterior estimates for the model: 

```{r}
mod_linear <- read_rds("model_linear.rds")

tidy(mod_linear) %>% 
  mutate(across(
    .cols = 5:8, 
    round, 
    2), 
    term = str_replace(term, "med", "sensitivity")) %>% 
  kableExtra::kable(format = "latex",
    align = "c",
    booktabs = TRUE,
    longtable = TRUE,
    linesep = "",
    ) %>%
 kableExtra::kable_styling(
      position = "left",
      latex_options = c("striped", "repeat_header"),
      stripe_color = "gray!15"
    )
```

However, when we check the posterior predictions of the model, we notice considerable discrepancies with the data: 

```{r}
pp_check(mod_linear) +
    labs(title = "Posterior Predictions", 
       subtitle = "Linear Model, Tau and Sensitivity")
```

The data is clearly bimodal and our model is not capturing this. Our model mostly predicts values of $\tau$ in a region where they are quite sparse in our data. 

As we explain in the text, a way to deal with this problem is to fit a mixture model. We are going to stipulate that the bimodal distributed pictured above is a combination of two distributions. In this case, we choose two beta distributions, because they are bounded between 0 and 1, just like our data. 

Then, in the same model, we ask whether the sensitivity of an issue is associated with the probability of its $\tau$ being drawn from the beta distribution with higher values on average. If this is the case, then there is a positive relationship between an issue's sensitivity and its $\tau$. 

We could express the model as follows. We have two distirbutions, and we want to estimate the probability that a given value of $\tau$ is drawn from one or the other. Given that the outcome is binary, we can express it as a bernoulli trial (Franke, 2023): 

$$ g_i \sim \text{Bernoulli}(p) $$
Our two distributions -- call them $0$ and $1$ -- are two Beta distributions with their respective parameters: 

$$ g_0 \sim Beta(\alpha_0, \beta_0) $$
$$ g_1 \sim Beta(\alpha_1, \beta_1) $$
Our central target our knowledge is: given a value of $\tau$, what distribution is it more likely to have come from?

$$ \tau_i \sim Beta(\alpha_{g_i}, \beta_{g_i}) $$

But then, we also examine whether the probability $p$ of being in a given group is associated with an issue's sensitivity. As above, we include varying intercepts and slopes at the level of country: 

$$ g_i \sim \text{Bernoulli}(p) $$
$$ \text{logit}(p_i) \sim \alpha_{\text{country}[i]} + \beta_{\text{country}[i]}S_i$$
$$ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}} \end{pmatrix} \; \sim \text{MVN} \bigg[ \begin{pmatrix} \alpha_{\text{country}} \\ \beta_{\text{country}}   \end{pmatrix} \;, S \bigg]$$
$$ S = \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; R \begin{pmatrix} \sigma_\alpha & 0 \\ 0 & \sigma_\beta \end{pmatrix} \; $$

Table 3 displays the posterior estimates from the model: 


```{r}
mod_beta <- read_rds("model_beta.rds")

tidy(mod_beta) %>% 
  mutate(across(
    .cols = 5:8, 
    round, 
    2), 
    term = str_replace(term, "med", "sensitivity"), 
    term = str_replace(term, "theta2", "p")) %>% 
  kableExtra::kable(format = "latex",
    align = "c",
    booktabs = TRUE,
    longtable = TRUE,
    linesep = "",
    ) %>%
 kableExtra::kable_styling(
      position = "left",
      latex_options = c("striped", "repeat_header"),
      stripe_color = "gray!15"
    )
```

Though the substantial conclusions are not much different, the posterior predictive checks look more in line with the data:

```{r}
pp_check(mod_beta) +
  labs(title = "Posterior Predictions", 
       subtitle = "Mixed Model, Tau and Sensitivity")
```

